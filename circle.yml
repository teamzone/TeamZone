machine:
  node:
    version: 4.3.2
    
  environment:
# this REDIS Url is for the cibuild location
    REDISTOGO_URL: redis://rediscloud:c5DS4STm0sBTQNZS@pub-redis-14750.us-east-1-4.2.ec2.garantiadata.com:14750
    UITEST_BROWSER: Chrome
    UITEST_BROWSER_VERSION: 50
    UITEST_OS: Windows
    UITEST_OS_VERSION: 10
    UITEST_RESOLUTION: 1680x1050
    UITEST_SERVER: http://hub.browserstack.com/wd/hub
    UITEST_LOCAL_TEST: false
    UITEST_DEBUG: true 
    TEAMZONE_URL: http://circleci-cibuild.herokuapp.com

general:
  artifacts:
    - "coverage.lcov" 
    
test:
  pre:
    - npm install -g grunt-cli
    
  override:
    - grunt cibuild 
# get a copy of build results to the test reports folder for sfae keeping and uniqueness    
    = cp test-results.xml $CIRCLE_TEST_REPORTS/cibuild-testResults.xml
# Deploy to the heroku site so some ui-tests can run, not all just a sanity check.  They can be slow and another build will run the full suite
    - git push git@heroku.com:circleci-cibuild.git $CIRCLE_SHA1:master --force
#run mocha to test the UI Test
    - node node_modules/mocha/bin/_mocha -t 20000 --reporter mocha-circleci-reporter ui-test/full/steps/testLoginWithEmail.js
    = cp test-results.xml $CIRCLE_TEST_REPORTS/cibuild-uiTestResults.xml

deployment:
  dev:
    branch: master
    heroku:
      appname: circleci-cibuild
  uit:
    branch: UIT
    heroku:
      appname: circleci-cibuild
  staging:
      branch: staging
      heroku:
        appname: circleci-cibuild-staging      